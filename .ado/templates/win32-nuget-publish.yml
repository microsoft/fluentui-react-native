steps:
  - checkout: self
    persistCredentials: true

  - template: setup-repo-min-build.yml

  - script: |
      yarn build
    displayName: 'Building the repo'

  - script: |
      yarn bundle
    workingDirectory: apps/win32
    displayName: 'Bundling win32'

  # generate the sanitizedBuildNumber environment variable
  # - bash: '.ado/scripts/generate_build_number.sh'
  #   displayName: 'Generate Build Number'

  # pack the nuspec
  # - task: NuGetCommand@2
  #   displayName: 'NuGet pack'
  #   inputs:
  #     command: pack
  #     packagesToPack: 'apps/win32/nuget/Microsoft.FluentUI.FluentTesterWin32.nuspec'
  #     buildProperties: commitId=$(Build.SourceVersion);repoUri=$(Build.Repository.Uri);version=$(Build.BuildNumber)

  - task: CmdLine@1
    displayName: 'Create NuGet package for FluentTester Win32 bundle.'
    inputs:
        filename: nuget
        arguments: 'pack Microsoft.FluentUI.FluentTesterWin32.nuspec -OutputDirectory $(Build.ArtifactStagingDirectory) -OutputFileNamesWithoutVersion -Verbosity detailed -Version $(Build.BuildNumber)'
        workingFolder: 'apps/win32/nuget'

  # push the package package
  - task: NuGetCommand@2
    displayName: 'NuGet push'
    inputs:
      command: push
      packagesToPush: '$(Build.ArtifactStagingDirectory)/Microsoft.FluentUI.FluentTesterWin32.*.nupkg'
      nuGetFeedType: external
      publishFeedCredentials: react-native
