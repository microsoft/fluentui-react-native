name: PR Validation

on:
  pull_request:
    branches:
      - main

jobs:
  check-changesets:
    name: Check for Changesets
    runs-on: ubuntu-latest
    # Skip this check for the version bump PR created by changesets
    if: ${{ github.head_ref != 'changeset-release/main' }}

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '22'
          cache: 'yarn'

      - name: Enable Corepack
        run: corepack enable

      - name: Install dependencies
        run: yarn install --immutable

      - name: Check for changesets
        run: |
          echo "üîç Checking for changesets..."

          # Check if changesets exist
          if yarn changeset status --since=origin/main 2>&1 | grep -q "No changesets present"; then
            echo "‚ùå No changesets found"
            echo ""
            echo "This PR requires a changeset to document the changes."
            echo ""
            echo "To create a changeset, run:"
            echo "  yarn changeset"
            echo ""
            echo "The changeset bot has also left a comment on this PR with instructions."
            exit 1
          else
            echo "‚úÖ Changesets found"
            yarn changeset status --verbose
          fi
